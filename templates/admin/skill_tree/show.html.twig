{% extends 'base.html.twig' %}

{% block title %}Skill Tree: {{ tree.name }}{% endblock %}

{% block body %}
    <main class="max-w-6xl mx-auto px-4 py-8 space-y-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-sm text-slate-400 space-x-1">
                    <a href="{{ path('admin_home') }}" class="hover:text-sky-300">Admin</a>
                    <span>/</span>
                    <a href="{{ path('admin_skill_tree_index') }}" class="hover:text-sky-300">Skill Trees</a>
                    <span>/</span>
                    <span class="text-slate-300">{{ tree.name }}</span>
                </p>
                <h1 class="text-3xl font-semibold">{{ tree.name }} ({{ tree.code }})</h1>
            </div>
            <div class="flex flex-wrap gap-2">
                <a class="btn btn-ghost" href="{{ path('admin_skill_tree_index') }}">&larr; Back to list</a>
                <a class="btn btn-primary" href="{{ path('admin_skill_tree_edit', { id: tree.id }) }}">Edit</a>
                <a class="btn btn-ghost" href="{{ path('admin_skill_tree_export', { id: tree.id }) }}">Export</a>
                <form method="post" action="{{ path('admin_skill_tree_delete', { id: tree.id }) }}" class="inline" onsubmit="return confirm('Delete this skill tree?');">
                    <input type="hidden" name="_token" value="{{ csrf_token('delete_skill_tree_' ~ tree.id) }}">
                    <button type="submit" class="btn btn-ghost text-red-300">Delete</button>
                </form>
            </div>
        </div>

        <div data-controller="locale-toggle" data-locale-toggle-active-value="fr" class="space-y-3">
            <div class="flex justify-end gap-2">
                <button type="button" class="btn btn-primary flex items-center gap-2" data-locale-toggle-target="tab" data-locale="fr" data-action="click->locale-toggle#switch">
                    {{ ux_icon('flagpack:fr', { class: 'w-5 h-5' }) }}
                    <span>Francais</span>
                </button>
                <button type="button" class="btn btn-ghost flex items-center gap-2" data-locale-toggle-target="tab" data-locale="en" data-action="click->locale-toggle#switch">
                    {{ ux_icon('flagpack:gb-ukm', { class: 'w-5 h-5' }) }}
                    <span>English</span>
                </button>
            </div>

            <div class="card p-5 space-y-3">
                <div data-locale-toggle-target="panel" data-locale="fr" class="space-y-2">
                    <div class="flex justify-between border-b border-slate-800 pb-2">
                        <dt class="text-slate-400">Name</dt>
                        <dd class="font-semibold">{{ translations.fr.name ?: '-' }}</dd>
                    </div>
                    <div class="space-y-1">
                        <dt class="text-slate-400">Description</dt>
                        <dd class="font-semibold whitespace-pre-line">{{ translations.fr.description ?: '-' }}</dd>
                    </div>
                </div>

                <div class="space-y-2 hidden" data-locale-toggle-target="panel" data-locale="en">
                    <div class="flex justify-between border-b border-slate-800 pb-2">
                        <dt class="text-slate-400">Name</dt>
                        <dd class="font-semibold">{{ translations.en.name ?: '-' }}</dd>
                    </div>
                    <div class="space-y-1">
                        <dt class="text-slate-400">Description</dt>
                        <dd class="font-semibold whitespace-pre-line">{{ translations.en.description ?: '-' }}</dd>
                    </div>
                </div>
            </div>
        </div>

        <div class="card p-6 space-y-4">
            <div class="flex justify-between border-b border-slate-800 pb-2">
                <dt class="text-slate-400">Code</dt>
                <dd class="font-semibold">{{ tree.code }}</dd>
            </div>
            <div class="flex justify-between border-b border-slate-800 pb-2">
                <dt class="text-slate-400">Grid</dt>
                <dd class="font-semibold">{{ tree.columns }} x {{ tree.rows }}</dd>
            </div>
            <div class="flex justify-between border-b border-slate-800 pb-2">
                <dt class="text-slate-400">Nodes</dt>
                <dd class="font-semibold">{{ tree.nodes|length }}</dd>
            </div>
            <div class="flex justify-between border-b border-slate-800 pb-2">
                <dt class="text-slate-400">Links</dt>
                <dd class="font-semibold">{{ tree.links|length }}</dd>
            </div>
            <div class="flex justify-between border-b border-slate-800 pb-2">
                <dt class="text-slate-400">Created</dt>
                <dd class="font-semibold">{{ tree.createdAt|date('Y-m-d H:i') }}</dd>
            </div>
            <div class="flex justify-between">
                <dt class="text-slate-400">Updated</dt>
                <dd class="font-semibold">{{ tree.updatedAt|date('Y-m-d H:i') }}</dd>
            </div>
        </div>

        <section
            class="grid-test skill-tree-builder max-w-full print:max-w-full print:p-0 flex flex-col gap-6"
            data-controller="skill-tree-builder"
            data-skill-tree-builder-readonly-value="true"
            data-skill-tree-builder-placeholder-value="https://placehold.co/120?text=?"
            data-skill-tree-builder-initial-value="{{ initialPayload|json_encode|e('html_attr') }}"
        >
            <section class="grid-test__wrap rounded-sm print:rounded-none shadow-sm print:shadow-none">
                <div class="grid-test__stage">
                    <div class="skill-tree-builder__canvas">
                        <svg class="skill-tree-builder__links" data-skill-tree-builder-target="links"></svg>
                        <div
                            class="grid-test__grid skill-tree-builder__grid"
                            data-skill-tree-builder-target="grid"
                            style="--cols: {{ columns }}; --rows: {{ rows }};"
                        >
                            {% for row in 1..rows %}
                                {% for col in 1..columns %}
                                    <button
                                        class="grid-test__cell skill-tree__cell"
                                        type="button"
                                        aria-label="Cell {{ row }}-{{ col }}"
                                        aria-pressed="false"
                                        data-row="{{ row }}"
                                        data-col="{{ col }}"
                                    >
                                        <span class="grid-test__nameplate" aria-hidden="true">
                                            {{ component('SkillPlate', {
                                                code: 'NAME',
                                                image: 'https://placehold.co/120?text=?',
                                                cost: 0,
                                                isStarter: true
                                            }) }}
                                        </span>
                                    </button>
                                {% endfor %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </section>
        </section>
    </main>
{% endblock %}
