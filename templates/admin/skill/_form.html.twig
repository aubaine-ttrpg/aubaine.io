{% set icon_path = iconSrc ?? 'https://placehold.co/90?text=?' %}
{% set submit_label = submit_label ?? 'Save' %}

{{ form_start(form, { attr: { 'data-skill-form': '', 'data-controller': 'action-fields' } }) }}
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="card p-5 flex flex-col gap-4">
            <div class="flex items-start gap-4" data-controller="icon-preview" data-icon-preview-placeholder-value="{{ icon_path }}">
                <div class="icon-edit-wrap" data-icon-preview-target="preview" title="Click to change icon" data-action="click->icon-preview#triggerUpload">
                    <img src="{{ icon_path }}" alt="" onerror="this.onerror=null; this.src='https://placehold.co/90?text=?';">
                    <div class="icon-edit-overlay">
                        {{ ux_icon('heroicons:paint-brush', { class: 'w-6 h-6 text-sky-200' }) }}
                    </div>
                </div>
                <div class="flex-1 space-y-3">
                    <div>
                        <label class="label" for="{{ form.name.vars.id }}">Name</label>
                        {{ form_widget(form.name, { attr: { class: 'input' } }) }}
                    </div>
                    <label class="inline-flex items-center gap-2 text-slate-200">
                        {{ form_widget(form.renameIcon, { attr: { class: 'checkbox' } }) }}
                        <span>Rename icon</span>
                    </label>
                </div>

                {{ form_widget(form.icon, { attr: { class: 'hidden', 'data-icon-preview-target': 'input', 'data-action': 'change->icon-preview#updatePreview' } }) }}
            </div>
            <div class="space-y-3">
                <div>
                    <label class="label" for="{{ form.code.vars.id }}">Code</label>
                    {{ form_widget(form.code, { attr: { class: 'input' } }) }}
                </div>
                <label class="inline-flex items-center gap-2 text-slate-200">
                    {{ form_widget(form.ultimate, { attr: { class: 'checkbox' } }) }}
                    <span>Ultimate</span>
                </label>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div>
                        <label class="label" for="{{ form.usageLimitAmount.vars.id }}">Usage limit</label>
                        {{ form_widget(form.usageLimitAmount, { attr: { class: 'input', min: 0 } }) }}
                    </div>
                    <div>
                        <label class="label" for="{{ form.usageLimitPeriod.vars.id }}">Limit period</label>
                        {{ form_widget(form.usageLimitPeriod, { attr: { class: 'input' } }) }}
                    </div>
                </div>
                <div>
                    <label class="label" for="{{ form.category.vars.id }}">Category</label>
                    {{ form_widget(form.category, { attr: { class: 'input' } }) }}
                </div>
                <div>
                    <label class="label" for="{{ form.type.vars.id }}">Type</label>
                    {{ form_widget(form.type, { attr: { class: 'input', 'data-action-fields-target': 'type' } }) }}
                </div>
                <div>
                    <label class="label" for="{{ form.source.vars.id }}">Source</label>
                    {{ form_widget(form.source, { attr: { class: 'input' } }) }}
                </div>
            </div>
        </div>

        <div class="card p-5 lg:col-span-2 space-y-4">
            <div class="space-y-2">
                <label class="label" for="{{ form.description.vars.id }}">Description</label>
                {{ form_widget(form.description, { attr: { class: 'input min-h-[200px]' } }) }}
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="label" for="{{ form.range.vars.id }}">Range</label>
                    {{ form_widget(form.range, { attr: { class: 'input' } }) }}
                </div>
                <div>
                    <label class="label" for="{{ form.duration.vars.id }}">Duration</label>
                    {{ form_widget(form.duration, { attr: { class: 'input' } }) }}
                </div>
            </div>

            <div class="space-y-2">
                <label class="label">Tags (<span data-tags-count>0</span>)</label>
                {{ form_widget(form.tags, { attr: { class: 'input', 'data-controller': 'multi-select', 'data-multi-select-type-value': 'tags' } }) }}
            </div>
        </div>

        <div class="card p-5 lg:col-span-3 space-y-4" data-action-fields-target="card">
            <div class="flex items-start justify-between gap-2">
                <div>
                    <h3 class="text-lg font-semibold">Action specifications</h3>
                    <p class="text-sm text-slate-400">Only for Action / Bonus Action / Reaction / Attack.</p>
                </div>
                <span class="text-xs text-slate-500" data-action-card-hint>Disabled for non-action types</span>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="space-y-2">
                    <label class="label" for="{{ form.energyCost.vars.id }}">Energy Cost</label>
                    {{ form_widget(form.energyCost, { attr: { class: 'input', min: 0, 'data-action-fields-target': 'actionField' } }) }}
                </div>
                <div class="col-span-1 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
                    <label class="inline-flex items-center justify-between gap-2 text-slate-200">
                        <span>Concentration</span>
                        {{ form_widget(form.concentration, { attr: { class: 'checkbox', 'data-action-fields-target': 'actionField' } }) }}
                    </label>
                    <label class="inline-flex items-center justify-between gap-2 text-slate-200">
                        <span>Ritual</span>
                        {{ form_widget(form.ritual, { attr: { class: 'checkbox', 'data-action-fields-target': 'actionField' } }) }}
                    </label>
                </div>
            </div>

            <div class="space-y-2">
                <label class="label">Abilities</label>
                {{ form_widget(form.abilities, { attr: { class: 'input', 'data-controller': 'multi-select', 'data-multi-select-type-value': 'abilities', 'data-action-fields-target': 'actionField' } }) }}
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <label class="inline-flex items-center gap-2 text-slate-200">
                    {{ form_widget(form.attackRoll, { attr: { class: 'checkbox', 'data-action-fields-target': 'actionField' } }) }}
                    <span>Attack roll</span>
                </label>
                <label class="inline-flex items-center gap-2 text-slate-200">
                    {{ form_widget(form.savingThrow, { attr: { class: 'checkbox', 'data-action-fields-target': 'actionField' } }) }}
                    <span>Saving throw</span>
                </label>
                <label class="inline-flex items-center gap-2 text-slate-200">
                    {{ form_widget(form.abilityCheck, { attr: { class: 'checkbox', 'data-action-fields-target': 'actionField' } }) }}
                    <span>Ability check</span>
                </label>
            </div>

            <div class="space-y-2">
                <label class="label" for="{{ form.materials.vars.id }}">Materials</label>
                {{ form_widget(form.materials, { attr: { class: 'input', 'data-action-fields-target': 'actionField' } }) }}
            </div>
        </div>

        <div class="lg:col-span-3 flex justify-end">
            <button type="submit" class="btn btn-primary">{{ submit_label }}</button>
        </div>
    </div>
{{ form_end(form) }}
