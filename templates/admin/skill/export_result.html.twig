{% extends 'base.html.twig' %}

{% set separator = '•' %}

{% block title %}Export Skills{% endblock %}

{% block body %}
    <main class="max-w-6xl mx-auto px-4 py-8 print:max-w-full print:p-0">
        <div class="flex items-center justify-between hide-print">
            <div>
                <p class="text-sm text-slate-400">
                    <a href="{{ path('admin_home') }}" class="hover:text-sky-300">Admin</a>
                    <span>/</span>
                    <a href="{{ path('admin_skill_index') }}" class="hover:text-sky-300">Skills</a>
                    <span>/</span>
                    <span class="text-slate-300">Export</span>
                </p>
                <h1 class="text-3xl font-semibold">Export Result</h1>
            </div>
            <a class="btn btn-ghost" href="{{ path('admin_skill_export') }}">← New export</a>
        </div>

        {% if hash %}
            <div class="card p-4 text-sm text-slate-300 break-all hide-print">
                Export link: {{ path('admin_skill_export_hash', { hash: hash }) }}
            </div>
        {% endif %}

        {% if skills is not empty %}
            <div class="gap-6 print:gap-2 print-columns my-4 print:my-0 print:align-middle">
                {% set comp_verbal = 'skill.component.verbal'|trans({}, 'skills', export_locale)|u.slice(0,1)|upper %}
                {% set comp_somatic = 'skill.component.somatic'|trans({}, 'skills', export_locale)|u.slice(0,1)|upper %}
                {% set comp_material = 'skill.component.material'|trans({}, 'skills', export_locale)|u.slice(0,1)|upper %}

                {% for skill in skills %}
                    {% set color = skill.type.color() %}
                    {% set iconKey = skill.type.icon() %}
                    {% set iconClass = skill.type.iconClass() %}
                    {% set tags = skill.tags|filter(t => t.value != 'none') %}
                    {% set translated_tags = tags|map(t => ('skill.tag.' ~ t.value)|trans({}, 'skills', export_locale)) %}


                    <div class="bg-{{ color }}-50 border-2 border-{{ color }}-900 text-{{ color }}-950 rounded-xl p-6 print:p-2 mb-2 w-full avoid-break flex flex-col gap-2">
                        {# Header #}
                        <div class="flex items-center gap-3">
                            <img alt="" src="{{ skill.icon ?: 'https://placehold.co/90?text=?' }}" class="w-12 h-12 object-cover rounded-xl border border-slate-800" onerror="this.onerror=null; this.src='https://placehold.co/90?text=?';">
                            <div class="flex-1">
                                <h2 class="text-2xl print:text-sm font-semibold flex items-center gap-1">
                                    {{ skill.name }}
                                    {% if skill.abilities is not empty and enum('App\\Enum\\Ability').NONE not in skill.abilities %}
                                        <span>{{ separator }}</span>
                                            <span class="flex items-center gap-1">
                                                {% for ability in skill.abilities %}
                                                    {% set aIcon = ability.icon() %}
                                                    {% if aIcon is not empty %}
                                                        {{ ux_icon(aIcon, {class: 'w-6 h-6 print:w-4 print:h-4'}) }}
                                                    {% endif %}
                                                {% endfor %}
                                        </span>
                                    {% endif %}
                                </h2>
                                <span class="flex items-center gap-1 text-sm text-{{ color }}-900">
                                    {% if skill.category.value == 'ultimate' %}
                                        {{ ux_icon('game-icons:evil-wings') }}
                                        <p>{{ ('skill.category.' ~ skill.category.value)|trans({}, 'skills', export_locale) }}</p>
                                        <span>{{ separator }}</span>
                                    {% endif %}
                                    <p>{{ ('skill.type.' ~ skill.type.value)|trans({}, 'skills', export_locale) }}</p>
                                </span>
                            </div>
                            {{ ux_icon(iconKey, {class: 'w-10 h-10 text-' ~ color ~ '-900 ' ~ (iconClass|default('')) }) }}
                        </div>

                        {#-- Skill details --#}
                        <div class="p-1 rounded-lg text-black bg-white space-y-2 print:space-y-0 text-sm print:text-xs leading-relaxed print:leading-none">
                            <div class="flex flex-wrap gap-3 print:gap-1">
                                {# Usage Limit #}
                                {% if skill.usageLimitAmount > 0 %}
                                    <span>{{ skill.usageLimitAmount }} p. {{ ('skill.limit_period.' ~ skill.usageLimitPeriod.value)|trans({}, 'skills', export_locale) }}</span>
                                    <span>{{ separator }}</span>
                                {% endif %}

                                {# Energy Cost #}
                                <span class="flex items-center gap-1">
                                    {{ ux_icon('mdi:thunder') }}
                                    {{ skill.energyCost }}
                                </span>

                                {# Components #}
                                {% set components = [] %}
                                {% if skill.hasVerbal %}{% set components = components|merge([comp_verbal]) %}{% endif %}
                                {% if skill.hasSomatic %}{% set components = components|merge([comp_somatic]) %}{% endif %}
                                {% if skill.hasMaterial %}
                                    {% set materialLabel = comp_material ~ (skill.materialString ? ' (' ~ skill.materialString ~ ')' : '') %}
                                    {% set components = components|merge([materialLabel]) %}
                                {% endif %}
                                {% if components is not empty %}
                                    <span>{{ separator }}</span>
                                    <span class="flex items-center gap-1">
                                        {{ ux_icon('mdi:tools') }}
                                        {{ components|join(', ') }}
                                    </span>
                                {% endif %}

                                {# Duration #}
                                <span>{{ separator }}</span>
                                <span class="flex items-center gap-1">
                                    {{ ux_icon('mdi:clock') }}
                                    {{ ('skill.duration.' ~ skill.duration.value)|trans({}, 'skills', export_locale) }}
                                </span>

                                <span>{{ separator }}</span>
                                <span class="flex items-center gap-1">
                                    {{ ux_icon('game-icons:arrow-dunk') }}
                                    {{ ('skill.range.' ~ skill.range.value)|trans({}, 'skills', export_locale) }}
                                </span>

                                {% if skill.hasConcentration %}
                                    <span>{{ separator }}</span>
                                    <span class="flex items-center gap-1">
                                        {{ ux_icon('game-icons:eyeball') }}
                                        {{ 'skill.label.concentration'|trans({}, 'skills', export_locale) }}
                                    </span>
                                {% endif %}
                                
                                {% if skill.hasRitual %}
                                    <span>{{ separator }}</span>
                                    <span class="flex items-center gap-1">
                                        {{ ux_icon('game-icons:campfire') }}
                                        {{ 'skill.label.ritual'|trans({}, 'skills', export_locale) }}
                                    </span>
                                {% endif %}
                            </div>
                        </div>

                        {# Description #}
                        <div class="whitespace-pre-line print:text-xs">{{ skill.description }}</div>

                        {#-- Skill tags --#}
                        {% if translated_tags is not empty %}
                            <div class="flex flex-wrap gap-1 text-xs">
                                {% for tag in translated_tags|sort %}
                                    <span class="px-2 py-1 bg-white text-{{ color }}-800 rounded-full">
                                        {{ tag }}
                                    </span>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="card p-6 text-slate-300">No skills match the current filters.</div>
        {% endif %}
    </main>
{% endblock %}
